#
#   Author: Rohith
#   Date: 2015-05-03 15:29:08 +0100 (Sun, 03 May 2015)
#
#  vim:ts=2:sw=2:et
#
---

- name: create the kubelet fleet unit
  template: 
    src:  kubernetes-kubelet.service.j2
    dest: /config/kubernetes/kubernetes-kubelet.service
  tags: 
    - kubernetes
    - kubernetes-minion
    - kubernetes-kubelet
  when: fleet_deployed

- name: starting the kubelet service via fleet
  delegate_to: "{{ kubernetes_master_hostname }}"
  fleet: 
    command: start
    endpoint: "http://{{ kubernetes_master_hostname }}:4001"
    unit: /config/kubernetes/kubernetes-kubelet.service
  register: result
  failed_when: result.msg != 'OK'
  changed_when: result.msg != 'OK'
  tags: 
    - kubernetes
    - kubernetes-minion
    - kubernetes-kubelet
  when: fleet_deployed

- name: adding the kubernetes kubelet service
  template: src=kubernetes-kubelet.service.j2 dest={{ systemd_dir }}/kubernetes-kubelet.service 
  notify: 
    - reload services
    - restart kubernetes kubelet
  tags: 
    - kubernetes
    - kubernetes-minion
    - kubernetes-kubelet
  when: fleet_deployed == false

- name: start the kubernetes kubelet service
  service: name=kubernetes-kubelet state=started enabled=yes
  tags: 
    - kubernetes
    - kubernetes-minion
    - kubernetes-kubelet
  when: fleet_deployed == false
